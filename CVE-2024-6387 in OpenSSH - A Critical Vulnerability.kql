//regreSSHion: Uncovering CVE-2024-6387 in OpenSSH - A Critical Vulnerability
//Ref Link : https://www.splunk.com/en_us/blog/security/cve-2024-6387-regresshion-vulnerability.html
CommonSecurityLog // Firewall logs stream to CommonSecurityLog 
| where TimeGenerated >= ago(1h)
| where DestinationPort == 22
| project TimeGenerated, DeviceVendor, DeviceProduct, DeviceVersion, Activity, LogSeverity, DeviceAction, ApplicationProtocol, DestinationTranslatedAddress, DestinationIP, DestinationPort, SourceIP, ReceivedBytes, SentBytes, Protocol, MaliciousIP, ThreatSeverity, IndicatorThreatType, ThreatConfidence, MaliciousIPCountry, Computer, SimplifiedDeviceAction
| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), SSH_Connection=count() by MaliciousIPCountry, DestinationIP, DestinationPort, SourceIP, LogSeverity, DeviceAction, ApplicationProtocol, ThreatSeverity, IndicatorThreatType, ThreatConfidence, Computer, SimplifiedDeviceAction // Attack source is non-distributed, triangulate by country level
| project-reorder StartTime, EndTime
| sort by SSH_Connection desc
| where SSH_Connection > 360 // 1x60x6 = 360 connections for past one hour
